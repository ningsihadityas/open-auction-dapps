{"ast":null,"code":"import Web3 from 'web3'; // import Marketplace from 'contracts/Marketplace.json';\n\nimport MainAuction from 'contracts/MainAuction.json'; // import MainAuction from 'contracts/jajaja.json';\n\nlet selectedAccount; // let erc20Contract;\n// let isInitialized = false;\n\nexport const init = async () => {\n  let provider = window.ethereum;\n\n  if (typeof provider !== 'undefined') {\n    provider.on('accountsChanged', () => window.location.reload());\n    return provider.request({\n      method: 'eth_requestAccounts'\n    }).then(accounts => {\n      selectedAccount = accounts[0];\n      return selectedAccount;\n    }).catch(err => {\n      console.log(err);\n      return;\n    });\n  } else if (window.web3) {\n    window.web3 = new Web3(window.web3.currentProvider);\n  } else {\n    console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n  }\n}; // export const getProductData = async () => {\n// \tlet provider = window.ethereum;\n// \tlet marketContract;\n// \tconst web3 = new Web3(provider);\n// \tconst networkId = await web3.eth.net.getId();\n// \tlet products = [];\n// \tmarketContract = new web3.eth.Contract(Marketplace.abi, Marketplace.networks[networkId].address);\n// \tlet productCount = await marketContract.methods.productCount().call();\n// \t// Load products\n// \tfor (var i = 1; i <= productCount; i++) {\n//         const product = await marketContract.methods.products(i).call();\n// \t\tlet millis = parseFloat(product.timestamp) * 1000;\n// \t\tlet productPrice = web3.utils.fromWei(product.price.toString(), \"ether\")\n// \t\tlet product_time = new Date(millis).toLocaleString();\n// \t\tproducts.push({\n// \t\t\tid: product.id,\n// \t\t\tproduct_name: product.name,\n// \t\t\towner: product.owner,\n// \t\t\tseller: product.seller,\n// \t\t\tproduct_price: productPrice,\n// \t\t\tproduct_idr: product.idr_price,\n// \t\t\tstatus_buy: product.purchased,\n// \t\t\ttimestamp: product_time\n// \t\t});\n// \t}\n// \treturn products;\n// }\n// export const createProduct = async (name, price, idrPrice, seller) => {\n// \tlet provider = window.ethereum;\n// \tlet marketContract;\n// \tconst web3 = new Web3(provider);\n// \tconst networkId = await web3.eth.net.getId();\n// \tmarketContract = new web3.eth.Contract(Marketplace.abi, Marketplace.networks[networkId].address);\n// \treturn marketContract.methods.createProduct(name, price, idrPrice).send({from: seller})\n// \t.then(productData => {\n// \t\treturn productData\n// \t}).catch(err => {\n// \t\treturn err.message;\n// \t});\n// }\n\nexport const createAuction = async (assetName, assetDetail, startPrice, assetOwner, ownerDeposite, auctionDuration) => {\n  let provider = window.ethereum;\n  let mainAuctionContract;\n  const web3 = new Web3(provider); // const networkId = await web3.eth.net.getId();\n\n  const networkId = await web3.eth.net.getId();\n  let depositeOwner = web3.utils.fromWei(auction.ownerDeposite.toString(), 'ether');\n  mainAuctionContract = new web3.eth.Contract(MainAuction.abi, MainAuction.networks[networkId].address);\n  return mainAuctionContract.methods.createAuction(assetName, assetDetail, startPrice, auctionDuration).send({\n    from: assetOwner,\n    value: depositeOwner\n  }).then(auctionData => {\n    return auctionData;\n  }).catch(err => {\n    return err.message;\n  });\n};\nexport const getAuctionData = async () => {\n  let provider = window.ethereum;\n  let mainAuctionContract; // marketContract\n\n  const web3 = new Web3(provider);\n  const networkId = await web3.eth.net.getId();\n  let auctions = [];\n  mainAuctionContract = new web3.eth.Contract(MainAuction.abi, MainAuction.networks[networkId].address);\n  let auctionCount = await mainAuctionContract.methods.auctionCount().call(); // Load products\n\n  for (var i = 1; i <= auctionCount; i++) {\n    const auction = await mainAuctionContract.methods.auctions(i).call();\n    let millis = parseFloat(auction.timestamp) * 1000;\n    let startPrice = web3.utils.fromWei(auction.startPrice.toString(), 'ether');\n    let ownerDeposite = web3.utils.fromWei(auction.ownerDeposite.toString(), 'ether');\n    let auction_time = new Date(millis).toLocaleString();\n    auctions.push({\n      auctionId: auction.auctionId,\n      assetName: auction.assetName,\n      assetDetail: auction.assetDetail,\n      startPrice: startPrice,\n      assetOwner: auction.assetOwner,\n      ownerDeposite: ownerDeposite,\n      auctionDuration: auction.auctionDuration // bidding: auction.biddingList,\n\n    });\n  }\n\n  return auctions; // return mainAuctionContract.methods.auctions(1);\n}; // export const purchaseProduct = async (id, price, buyerAddr) => {\n//   let provider = window.ethereum;\n//   let marketContract;\n//   let priceToWei = Web3.utils.toWei(price, 'ether');\n//   const web3 = new Web3(provider);\n//   const networkId = await web3.eth.net.getId();\n//   marketContract = new web3.eth.Contract(\n//     Marketplace.abi,\n//     Marketplace.networks[networkId].address\n//   );\n//   return marketContract.methods\n//     .purchaseProduct(id)\n//     .send({ from: buyerAddr, value: priceToWei })\n//     .then((productData) => {\n//       return productData;\n//     })\n//     .catch((err) => {\n//       return err.message;\n//     });\n// };","map":{"version":3,"names":["Web3","MainAuction","selectedAccount","init","provider","window","ethereum","on","location","reload","request","method","then","accounts","catch","err","console","log","web3","currentProvider","createAuction","assetName","assetDetail","startPrice","assetOwner","ownerDeposite","auctionDuration","mainAuctionContract","networkId","eth","net","getId","depositeOwner","utils","fromWei","auction","toString","Contract","abi","networks","address","methods","send","from","value","auctionData","message","getAuctionData","auctions","auctionCount","call","i","millis","parseFloat","timestamp","auction_time","Date","toLocaleString","push","auctionId"],"sources":["/Users/adityas/Desktop/KULIAH/SMT8/open-auction-dapps/frontend/src/components/Web3Client.js"],"sourcesContent":["import Web3 from 'web3';\n// import Marketplace from 'contracts/Marketplace.json';\nimport MainAuction from 'contracts/MainAuction.json';\n\n// import MainAuction from 'contracts/jajaja.json';\n\nlet selectedAccount;\n\n// let erc20Contract;\n\n// let isInitialized = false;\n\nexport const init = async () => {\n  let provider = window.ethereum;\n\n  if (typeof provider !== 'undefined') {\n    provider.on('accountsChanged', () => window.location.reload());\n    return provider\n      .request({ method: 'eth_requestAccounts' })\n      .then((accounts) => {\n        selectedAccount = accounts[0];\n        return selectedAccount;\n      })\n      .catch((err) => {\n        console.log(err);\n        return;\n      });\n  } else if (window.web3) {\n    window.web3 = new Web3(window.web3.currentProvider);\n  } else {\n    console.log(\n      'Non-Ethereum browser detected. You should consider trying MetaMask!'\n    );\n  }\n};\n\n// export const getProductData = async () => {\n// \tlet provider = window.ethereum;\n// \tlet marketContract;\n// \tconst web3 = new Web3(provider);\n// \tconst networkId = await web3.eth.net.getId();\n// \tlet products = [];\n\n// \tmarketContract = new web3.eth.Contract(Marketplace.abi, Marketplace.networks[networkId].address);\n// \tlet productCount = await marketContract.methods.productCount().call();\n// \t// Load products\n// \tfor (var i = 1; i <= productCount; i++) {\n//         const product = await marketContract.methods.products(i).call();\n// \t\tlet millis = parseFloat(product.timestamp) * 1000;\n// \t\tlet productPrice = web3.utils.fromWei(product.price.toString(), \"ether\")\n// \t\tlet product_time = new Date(millis).toLocaleString();\n// \t\tproducts.push({\n// \t\t\tid: product.id,\n// \t\t\tproduct_name: product.name,\n// \t\t\towner: product.owner,\n// \t\t\tseller: product.seller,\n// \t\t\tproduct_price: productPrice,\n// \t\t\tproduct_idr: product.idr_price,\n// \t\t\tstatus_buy: product.purchased,\n// \t\t\ttimestamp: product_time\n// \t\t});\n// \t}\n// \treturn products;\n// }\n\n// export const createProduct = async (name, price, idrPrice, seller) => {\n// \tlet provider = window.ethereum;\n// \tlet marketContract;\n// \tconst web3 = new Web3(provider);\n// \tconst networkId = await web3.eth.net.getId();\n\n// \tmarketContract = new web3.eth.Contract(Marketplace.abi, Marketplace.networks[networkId].address);\n// \treturn marketContract.methods.createProduct(name, price, idrPrice).send({from: seller})\n// \t.then(productData => {\n// \t\treturn productData\n// \t}).catch(err => {\n// \t\treturn err.message;\n// \t});\n// }\n\nexport const createAuction = async (\n  assetName,\n  assetDetail,\n  startPrice,\n  assetOwner,\n  ownerDeposite,\n  auctionDuration\n) => {\n  let provider = window.ethereum;\n  let mainAuctionContract;\n  const web3 = new Web3(provider);\n\n  // const networkId = await web3.eth.net.getId();\n  const networkId = await web3.eth.net.getId();\n  let depositeOwner = web3.utils.fromWei(\n    auction.ownerDeposite.toString(),\n    'ether'\n  );\n\n  mainAuctionContract = new web3.eth.Contract(\n    MainAuction.abi,\n    MainAuction.networks[networkId].address\n  );\n  return mainAuctionContract.methods\n    .createAuction(assetName, assetDetail, startPrice, auctionDuration)\n    .send({ from: assetOwner, value: depositeOwner })\n    .then((auctionData) => {\n      return auctionData;\n    })\n    .catch((err) => {\n      return err.message;\n    });\n};\n\nexport const getAuctionData = async () => {\n  let provider = window.ethereum;\n  let mainAuctionContract; // marketContract\n  const web3 = new Web3(provider);\n  const networkId = await web3.eth.net.getId();\n  let auctions = [];\n\n  mainAuctionContract = new web3.eth.Contract(\n    MainAuction.abi,\n    MainAuction.networks[networkId].address\n  );\n\n  let auctionCount = await mainAuctionContract.methods.auctionCount().call();\n  // Load products\n  for (var i = 1; i <= auctionCount; i++) {\n    const auction = await mainAuctionContract.methods.auctions(i).call();\n    let millis = parseFloat(auction.timestamp) * 1000;\n    let startPrice = web3.utils.fromWei(auction.startPrice.toString(), 'ether');\n    let ownerDeposite = web3.utils.fromWei(\n      auction.ownerDeposite.toString(),\n      'ether'\n    );\n    let auction_time = new Date(millis).toLocaleString();\n\n    auctions.push({\n      auctionId: auction.auctionId,\n      assetName: auction.assetName,\n      assetDetail: auction.assetDetail,\n      startPrice: startPrice,\n      assetOwner: auction.assetOwner,\n      ownerDeposite: ownerDeposite,\n      auctionDuration: auction.auctionDuration,\n      // bidding: auction.biddingList,\n    });\n  }\n  return auctions;\n  // return mainAuctionContract.methods.auctions(1);\n};\n// export const purchaseProduct = async (id, price, buyerAddr) => {\n//   let provider = window.ethereum;\n//   let marketContract;\n//   let priceToWei = Web3.utils.toWei(price, 'ether');\n//   const web3 = new Web3(provider);\n//   const networkId = await web3.eth.net.getId();\n\n//   marketContract = new web3.eth.Contract(\n//     Marketplace.abi,\n//     Marketplace.networks[networkId].address\n//   );\n//   return marketContract.methods\n//     .purchaseProduct(id)\n//     .send({ from: buyerAddr, value: priceToWei })\n//     .then((productData) => {\n//       return productData;\n//     })\n//     .catch((err) => {\n//       return err.message;\n//     });\n// };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}